# Memo_Internship_ZKX

因为10.1~10.8都在旅游or赶路wwww，每天抽一点时间来做，进度略慢，然后后面几天直接没更新文档，导致记不清哪天干了什么o(╥﹏╥)o，就大概讲一下每个功能怎么做的，可以直接看前面的部分。

还有很多未完善的部分、bug等，实在是没时间做了。

## 功能实现说明

我按照要求里面来一个一个地说吧

### 玩家操控

使用有限状态机来实现玩家的各个状态，包括：待机、移动、跳跃、攻击。

主要就是通过不同的状态进行不同的移动操作等，比较困难的就是梳理状态，因为状态之间会进行混合，比如跳跃的时候可以左右移动，解决方式是将操控的检测装成函数，在各个状态的Update中调用，实现跳跃的时候可以移动之类的操作，并且在各个状态中也对动画进行处理，实现流畅的动画播放。

另一个遇到的问题就是人物对地面的判定做的比较差，解决上使用碰撞体加Y轴速度来进行双重保险，虽然还是存在一些问题，有的时候站在地上仍然处于跳跃的状态，这个还没修改，后面也可以考虑再使用射线等方式增强判断。

目前做的箭矢也有些问题，箭矢在自身碰撞体基础上，还增加了箭头的Trigger来检测墙体，导致射怪物的时候会产生射中两次的情况，解决方式是直接将Trigger删掉，使用碰撞的法线方向来进行左右和上下的检测，实现钉在墙上的效果。

闪烁的部分写了个工具类，使用协程来控制SpriteRender实现闪烁，可以加速也可以不加速。

生命值及得分的部分使用单例PlayerManager来完成，同时在这里实现了存档功能；同时使用事件订阅来通知各个ui及关卡模块生命值及得分的改变，但里只用Action进行实现，比较简单，较为混乱，优化的话可以使用中枢通知器进行优化，根据事件名称来进行不同属性的改变通知。

游戏失败没来得及做。

### 镜头

镜头跟随使用cinemachine实现，并设置边界碰撞体。

### 地图

地图使用TileMap进行绘制，将不同的部分分为不同的画布，墙、单向平台、平台等。

单向平台增加了`Platform Effector 2D`组件

陷阱平台使用碰撞体检测玩家，以及协程实现消失与恢复。

刺使用碰撞体实现。

上下贯通机制采用Trigger，当玩家、道具、敌人离开地图区域后，将其传送到另一边。

背景就简单使用背景图，并制作了一个简易的`TimeLine`来循环移动云朵。

### 怪物

怪物写了个基类Enemy，主要实现一些初始化、受击、死亡、碰到玩家的方法，同时实现了怪物死亡后，从金币对象池生成一个金币。

然后用具体的怪物类继承。

#### 绿史莱姆

一开始想的是，使用Trigger来处理，然后使用协程来进行跳跃，但实现上发现跳跃的时候，动画跟位移跟不上，可能是参数没配好。另一个问题就是对于跳跃边界的处理，只是简单在预制体里多放了两个边界物品。这个史莱姆还有蛮多内容需要修改的，但时间不太够，初步的想法是：可以在Animation中添加代码的参数变化，用这个参数来进行位移；对于移动边界也可以使用射线检测来判断是否到悬崖边上；同样也可以将Trigger换成Collider来直接进行撞墙。

#### 小蓝

这个比较简单了，直接用碰撞体来进行转向。

#### 小黑

小黑这里实现了碰到墙面会掉头，但没对悬崖进行处理，跳跃的实现上采用每帧随机，并对是否在地面进行检测。对悬崖的处理同样可以增加射线检测等方式。

### 掉落物

击杀怪物后，随机从对象池中生成金币或硬币，为其添加一个初始的y轴速度，并持续播放动画，碰撞检测玩家拾取。

### 动画

这个部分没什么好写的，主要就是动画树以及与逻辑进行适配。

### 关卡

因为时间不够，简单搭了两个，主要就是进行功能的测试，可以在第二关中中直接测试所有的内容。

### UI

UI就是慢慢地搭，一开始搭的比较松弛，就比较有章法，各个点位什么的，后面没时间了就比较随意，搭好后再在代码中绑定各个事件。

关卡胜利上用了个LevelManager单例，一个关卡中将所有的怪物注册，怪物全死掉后通知胜利。

生命值、得分、关胜利ui方面也都是订阅各个单例模块的事件实现。也没什么好说的。

但总体上UI做的很乱，主要是时间不多，还有很多的细化空间，比如做一个UI管理器，打开ui的时候关闭另一个等等的。

游戏暂停使用Time.TimeScale来实现。

### 音效

这个做的十分的粗糙，只是简单的对每个物品、怪物、人物放AudioSource，用一个AudioManager来挂载各个音频文件。

有时间的话应该做一个中枢式的，当某个东西要播放某个音效的时候，调用AudioManager的函数来播放对应的音效，就不用在每个物品上都挂AudioSource等，也不会这么乱糟糟。

### 特殊Buff

Buff部分也与角色控制一样，使用有限状态机，在原来的基础上再加一个Buff的状态机，并且增加一个Fly的玩家控制状态。

在Buff的基类上实现buff的激活、移除、Update，并在其中进行各种状态等的切换。

同时Buff基类已经实现了Buff的时间长短，超过时间就自动移除这个Buff。

特殊Buff的道具就是简单的一个物品，并且也简单实现了随机生成。

## 进阶功能思路（有的没时间做，简单写一下思路）

### 选关UI

主要就是ui和关卡的交互，用`ContentSizeFitter+LayoutGroup`来进行关卡块的摆放，并实现关卡按钮的代码，点击不同的按钮开始不同的关卡，对于没解锁的在初始化的时候处理。

核心就是ui和数据的交互。

### 无缝过关动画

这个有两个思路

一个是切场景，让玩家不进行销毁，异步加载场景，当加载好后将其移动到指定的位置，并开启关卡，实现上不难，比较乱的就是各个状态的初始化。

另一个思路是将关卡都做成预制体，并且不切换场景，从资源中实例化预制体，可以使用Addressables来进行资源储存然后胜利后移动地图、玩家，并加载新地图。

### 网格系统（已经用了）

### 持久化存储（已经用了）

主要就是PlayerData，在胜利后更新关卡，以及关卡结束后更新总的得分，将其转化为json保存到PlayerPrefs中。

### 对象池（已经用了）

用了官方的ObjectPool

### 更好的敌人AI

这个还没去详细研究，大概就是使用行为树来实现，根据不同的条件进行不同的行为，比如靠近玩家就攻击，靠近悬崖就跳跃，被玩家打了就逃跑等等。

### 更多的关卡机制

弹簧：玩家踩上去后给他加个力或速度。

随机掉落物：随机生成就完事了

传送带：玩家站着的时候给刚体加速度或者力

定时平台：协程切换碰撞体的状态

掉落平台：和单向平台类似，就是把他反过来

### 双人模式

略复杂，但也不难，直接把目前的玩家操控抄一遍，修改控制按键。然后也改一下目前的PlayerManager等玩家数据相关。

## Day1

赶一天路，使用有限状态机实现玩家控制

遇到的问题：

1.使用OnCollisionExit2D来进行地面的判断，同时站在箭矢上使用同样的逻辑，导致产生“没有站在箭矢上面而是碰到箭矢的时候，玩家也可以跳跃”

解决：增加y轴向速度的判断

2.柱子使用的Tag和地面不一样，导致站在柱子上无法跳跃

解决：统一使用地面的Tag，但会导致问题3

3.箭矢碰撞体碰到地面也会产生钉在墙上的效果

解决：给箭矢的头部加一个小探针，从而实现只在箭矢头部的方向碰到碰撞体。

## Day2

旅游拉满

## Day3

晚上回酒店了简单干了一点

尝试实现史莱姆的跳动动画。

## Day4~Day5

旅游比较忙，基本就每天晚上做了一点点，忘更新文档

## Day6

这天晚上小熬夜做了一些

使用对象池做了箭矢，金币。

制作了各个敌人。

## Day7

这天比较好一些，在酒店做了一下午。

